<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Banknote Creator</title>
    <style>
        @font-face {
            font-family: 'Vazir';
            src: url('https://cdn.rawgit.com/rastikerdar/vazir-font/v27.0.0/dist/Vazir-Bold.woff2') format('woff2');
            font-weight: bold;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: 'Vazir', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #2c3e50;
        }

        .container {
            width: 100%;
            max-width: 700px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        h1 {
            color: #34495e;
            font-size: 2.5rem;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
        }

        .banknote-container {
            width: 600px;
            height: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            transition: all 0.5s ease-in-out;
            background-color: #f7f9fc;
            border: 1px solid #e0e0e0;
        }
        
        @media (max-width: 768px) {
            .banknote-container {
                width: 100%;
                max-width: 400px;
                height: 267px;
            }
        }

        .banknote-details {
            position: absolute;
            top: 20px;
            right: 20px;
            left: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            color: #2c3e50;
        }

        .details-top {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        .serial-key-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .serial, .key, .visual-key, .amount {
             transition: color 0.5s ease;
        }
        
        .amount {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .barcode-container {
            position: absolute;
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            place-items: center;
            padding: 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .barcode {
            width: 100px;
            height: 100px;
            opacity: 0.15;
            transition: opacity 0.5s ease;
        }
        
        .controls {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .input-group label {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 150px;
            font-size: 0.9rem;
            color: #555;
        }

        .input-group input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            outline: none;
            font-family: 'Vazir', sans-serif;
            font-size: 1rem;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Vazir', sans-serif;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        #redesignBtn { background-color: #3498db; }
        #redesignBtn:hover { background-color: #2980b9; }

        #downloadBtn { background-color: #2ecc71; }
        #downloadBtn:hover { background-color: #27ae60; }

        #generateAllBtn { background-color: #e67e22; }
        #generateAllBtn:hover { background-color: #d35400; }

        .validation-section {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .validation-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        #validateBtn {
            flex-grow: 0;
            background-color: #9b59b6;
        }
        #validateBtn:hover {
            background-color: #8e44ad;
        }
        
        .validation-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .validation-result.valid {
            background-color: #e8f9ee;
            color: #2ecc71;
        }
        
        .validation-result.invalid {
            background-color: #ffeaea;
            color: #e74c3c;
        }
        
        .canvas-container {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Digital Banknote Creator</h1>

        <div class="banknote-container" id="banknote-container">
             <div class="barcode-container">
                <img id="barcode-1" class="barcode" alt="Amount JAB Code">
                <img id="barcode-2" class="barcode" alt="Serial JAB Code">
                <img id="barcode-3" class="barcode" alt="Verification Key JAB Code">
                <img id="barcode-4" class="barcode" alt="Visual Key JAB Code">
            </div>
            <div class="banknote-details">
                <div class="details-top">
                    <div class="serial-key-group">
                        <span class="serial" id="serial">SERIALNUMB</span>
                        <span class="key" id="key">VERIFYKEY</span>
                        <span class="visual-key" id="visual-key">VISUALKEY</span>
                    </div>
                    <span class="amount" id="amount-display">100</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="input-group">
                <label for="inputAmount">Amount (1-100):
                    <input type="number" id="inputAmount" value="100" min="1" max="100">
                </label>
                <label for="inputCount">Number of Banknotes:
                    <input type="number" id="inputCount" value="1" min="1">
                </label>
            </div>
            
            <div class="buttons">
                <button id="redesignBtn">Redesign</button>
                <button id="downloadBtn">Download</button>
                <button id="generateAllBtn">Generate All</button>
            </div>
        </div>

        <div class="validation-section">
            <h3>Banknote Validation</h3>
            <div class="input-group">
                <label for="validationKey">Enter Verification Key:
                    <input type="text" id="validationKey" placeholder="Enter 8-character key">
                </label>
                <button id="validateBtn">Validate</button>
            </div>
            <div class="validation-result" id="validationResult"></div>
        </div>
    </div>
    
    <div class="canvas-container">
        <canvas id="banknoteCanvas" width="600" height="400"></canvas>
    </div>

    <script>
    /*
 JAB-Code-JavaScript - an open-source JAB Code Implementation for JavaScript
 Copyright (c) 2019-2023, Bc. Stefan Hausner, BA
 All rights reserved.
 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:
 1. Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
 2. Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation
    and/or other materials provided with the distribution.
 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var JabcodeJSInterface=function(){this.encode_message=function(r,t,e){var a=new JABCode(r,t,e),n=a.getModuleData(),o=document.createElement("canvas"),i=Math.floor(500/n[0].length),l=n[0].length*i,d=n.length*i;return o.width=l,o.height=d,this.draw(o,a,i),o.toDataURL("image/png")},this.draw=function(r,t,e){for(var a=r.getContext("2d"),n=t.getModuleData(),o=0;o<n.length;o++)for(var i=0;i<n[o].length;i++){var l=n[o][i].getColor();a.fillStyle=l,a.fillRect(i*e,o*e,e,e)}}};var Color=function(r){var t,e,a,n,o=JabColors.getPredefinedColor(r);return null!=o?o:(t=r,a=(e=new Array)[0]=(n=Math.floor(r/64))>>2&1,e[1]=n>>1&1,e[2]=1&n,t-=64*n,e[3]=(n=Math.floor(t/8))>>2&1,e[4]=n>>1&1,e[5]=1&n,t-=8*n,e[6]=t>>2&1,e[7]=t>>1&1,e[8]=1&t,this.bits=e,this)},JabColors={};JabColors.BLACK=new Color(0),JabColors.WHITE=new Color(511),JabColors.RED=new Color(292),JabColors.GREEN=new Color(42),JabColors.BLUE=new Color(146),JabColors.CYAN=new Color(188),JabColors.MAGENTA=new Color(438),JabColors.YELLOW=new Color(334),JabColors.VIOLET=new Color(219),JabColors.LIME=new Color(110),JabColors.AZURE=new Color(73),JabColors.ORANGE=new Color(310),JabColors.predefinedColors=[JabColors.BLACK,JabColors.WHITE,JabColors.RED,JabColors.GREEN,JabColors.BLUE,JabColors.CYAN,JabColors.MAGENTA,JabColors.YELLOW,JabColors.VIOLET,JabColors.LIME,JabColors.AZURE,JabColors.ORANGE],JabColors.colorNames=["BLACK","WHITE","RED","GREEN","BLUE","CYAN","MAGENTA","YELLOW","VIOLET","LIME","AZURE","ORANGE"],JabColors.getPredefinedColor=function(r){for(var t=0;t<JabColors.predefinedColors.length;t++)if(JabColors.predefinedColors[t].getName()==JabColors.colorNames[r])return JabColors.predefinedColors[t]};var Color=function(r){var t,e,a,n,o=JabColors.getPredefinedColor(r);return null!=o?o:(t=r,a=(e=new Array)[0]=(n=Math.floor(r/64))>>2&1,e[1]=n>>1&1,e[2]=1&n,t-=64*n,e[3]=(n=Math.floor(t/8))>>2&1,e[4]=n>>1&1,e[5]=1&n,t-=8*n,e[6]=t>>2&1,e[7]=t>>1&1,e[8]=1&t,this.bits=e,this)},ColorUtils={};ColorUtils.colorValue=function(r){return 8*ColorUtils.colorValueSection([r[3],r[4],r[5]])+ColorUtils.colorValueSection([r[6],r[7],r[8]])+64*ColorUtils.colorValueSection([r[0],r[1],r[2]])},ColorUtils.colorValueSection=function(r){return 4*r[0]+2*r[1]+r[2]},ColorUtils.getRGB=function(r){return[Math.round(255*ColorUtils.getDecimal(r[0],r[1],r[2])),Math.round(255*ColorUtils.getDecimal(r[3],r[4],r[5])),Math.round(255*ColorUtils.getDecimal(r[6],r[7],r[8]))]},ColorUtils.getDecimal=function(r,t,e){return.5*r+.25*t+.125*e},Color.prototype.getBits=function(){return this.bits},Color.prototype.getColor=function(){var r=ColorUtils.getRGB(this.getBits());return"rgb("+r[0]+","+r[1]+","+r[2]+")"},Color.prototype.getName=function(){return ColorUtils.colorValue(this.bits)};var ReedSolomon={};ReedSolomon.gexp=new Array(512),ReedSolomon.glog=new Array(256),ReedSolomon.INITIALIZED=!1,ReedSolomon.initialize=function(){var r,t;for(ReedSolomon.gexp[0]=1,ReedSolomon.gexp[255]=1,ReedSolomon.glog[0]=0,r=1,t=0;t<255;t++)r<<=1,r&256&&(r^=285),ReedSolomon.gexp[t]=r,ReedSolomon.glog[r]=t;for(t=255;t<512;t++)ReedSolomon.gexp[t]=ReedSolomon.gexp[t-255]},ReedSolomon.add=function(r,t){return r^t},ReedSolomon.sub=function(r,t){return r^t},ReedSolomon.mult=function(r,t){if(0==r||0==t)return 0;var e=ReedSolomon.glog[r],a=ReedSolomon.glog[t];return ReedSolomon.gexp[e+a]},ReedSolomon.div=function(r,t){if(0==t)throw"division by zero";if(0==r)return 0;var e=ReedSolomon.glog[r],a=ReedSolomon.glog[t];return ReedSolomon.gexp[e-a+255]},ReedSolomon.polyMult=function(r,t){for(var e=new Array(r.length+t.length-1),a=0;a<e.length;a++)e[a]=0;for(a=0;a<r.length;a++)for(var n=0;n<t.length;n++)e[a+n]=ReedSolomon.add(e[a+n],ReedSolomon.mult(r[a],t[n]));return e},ReedSolomon.polyDiv=function(r,t){for(var e=new Array(r.length),a=0;a<r.length;a++)e[a]=r[a];for(a=0;a<=e.length-t.length;a++){var n=e[a];if(0!=n)for(var o=1;o<t.length;o++)e[a+o]=ReedSolomon.sub(e[a+o],ReedSolomon.mult(t[o],n))}return e.slice(e.length-t.length+1)},ReedSolomon.generator=function(r){for(var t=[1],e=0;e<r;e++){var a=[1,ReedSolomon.gexp[e]];t=ReedSolomon.polyMult(t,a)}return t},ReedSolomon.encode=function(r,t){ReedSolomon.INITIALIZED||(ReedSolomon.initialize(),ReedSolomon.INITIALIZED=!0);for(var e=new Array(r.length+t),a=0;a<r.length;a++)e[a]=r[a];for(a=0;a<t;a++)e[r.length+a]=0;var n=ReedSolomon.generator(t);return e=ReedSolomon.polyDiv(e,n)};var Symbol=function(r,t,e,a){this.symbolSize=new SymbolSize(r,t),this.data=e,this.symbolType=a,this.moduleData=new Array};Symbol.prototype.placeFinderPatterns=function(){for(var r=0;r<this.symbolSize.getHeight();r++)for(var t=0;t<this.symbolSize.getWidth();t++)this.placeFinderPattern(r,t)},Symbol.prototype.placeFinderPattern=function(r,t){var e=this.symbolSize.getSymbolTypeSize().getDock(),a=this.symbolSize.getSymbolTypeSize().getSideLength();if(r<e&&t<e)this.setModule(r,t,JabColors.BLACK);else if(r<e&&t>=this.symbolSize.getWidth()-e)this.setModule(r,t,JabColors.RED);else if(r>=this.symbolSize.getHeight()-e&&t<e)this.setModule(r,t,JabColors.GREEN);else if(r>=this.symbolSize.getHeight()-e&&t>=this.symbolSize.getWidth()-e)this.setModule(r,t,JabColors.BLUE);else if(r<e)this.setModule(r,t,new Color(t%2));else if(r>=this.symbolSize.getHeight()-e)this.setModule(r,t,new Color(t%2));else if(t<e)this.setModule(r,t,new Color(r%2));else if(t>=this.symbolSize.getWidth()-e)this.setModule(r,t,new Color(r%2));else{var n=this.symbolSize.getSymbolTypeSize().getTile(),o=Math.floor((r-e)/n),i=Math.floor((t-e)/n);r-e-o*n==n-1&&t-e-i*n==n-1?this.setModule(r,t,JabColors.BLACK):r-e-o*n==n-1?this.setModule(r,t,new Color((t-e-i*n)%2)):t-e-i*n==n-1?this.setModule(r,t,new Color((r-e-o*n)%2)):this.setModule(r,t,new Color(7))}},Symbol.prototype.setModule=function(r,t,e,a){var n=new Module(r,t,e,a);this.moduleData[r][t]=n},Symbol.prototype.getModule=function(r,t){return this.moduleData[r][t]},Symbol.prototype.getModuleData=function(){return this.moduleData},Symbol.prototype.placeData=function(){for(var r=this.getBitStream(),t=0,e=0;e<r.length;e++){var a=this.getNextLocation(),n=new Color(r[e]);this.setModule(a[0],a[1],n),t++}},Symbol.prototype.getBitStream=function(){var r=new BitStream,t=this.getByteStream();r.addByte(this.symbolType);for(var e=0;e<this.data.length;e++)r.addByte(this.data.charCodeAt(e));var a=r.getBits();if(0==this.symbolSize.getSymbolTypeSize().getDataBits()){var n=r.getTerminator(this.symbolSize.getDataCodewords());return a.concat(n)}var o=this.symbolSize.getDataCodewords()-Math.ceil(a.length/9);if(o<0)throw"data too large";if(o>0)for(e=0;e<o;e++){var i=e%2==0?292:146;r.addByte(i)}var l=r.getBits();a=l;var d=new Array;for(e=0;e<this.symbolSize.getDataCodewords();e++){for(var s=0,b=0;b<9;b++)s+=Math.pow(2,8-b)*a[9*e+b];d.push(s)}var u=this.symbolSize.getRSNumber(),c=ReedSolomon.encode(d,u),g=new Array;for(e=0;e<c.length;e++)for(var h=c[e],C=8;C>=0;C--){var p=h-Math.pow(2,C);p>=0?(g.push(1),h=p):g.push(0)}var f=this.symbolSize.getSymbolTypeSize().getExtraBits();f>0&&(g=g.slice(0,g.length-f));return g},Symbol.prototype.getByteStream=function(){var r=new Array;r.push(this.symbolType);for(var t=0;t<this.data.length;t++)r.push(this.data.charCodeAt(t));var e=this.symbolSize.getDataCodewords()-r.length;if(e<0)throw"data too large";if(e>0)for(t=0;t<e;t++){var a=t%2==0?292:146;r.push(a)}var n=this.symbolSize.getRSNumber(),o=ReedSolomon.encode(r,n),i=new Array;for(t=0;t<o.length;t++)i.push(o[t]);return i},Symbol.prototype.initModuleData=function(){for(var r=0;r<this.symbolSize.getHeight();r++){this.moduleData.push(new Array);for(var t=0;t<this.symbolSize.getWidth();t++)this.moduleData[r].push(void 0)}},Symbol.prototype.getNextLocation=function(){for(var r=0;r<this.symbolSize.getHeight();r++)for(var t=0;t<this.symbolSize.getWidth();t++)if(void 0==this.getModule(r,t))return[r,t]};var SymbolSize=function(r,t){this.primarySymbol=r,this.secondarySymbols=t,this.totalSymbols=1+t,this.symbolTypeSize=new SymbolTypeSize(r),this.height=this.symbolTypeSize.getSideLength(),this.width=this.symbolTypeSize.getSideLength()*this.totalSymbols+(this.totalSymbols-1),this.dataCodewords=this.symbolTypeSize.getDataCodewords()*this.totalSymbols,this.rsNumber=this.symbolTypeSize.getRSNumber()*this.totalSymbols};SymbolSize.prototype.getPrimarySymbol=function(){return this.primarySymbol},SymbolSize.prototype.getSecondarySymbols=function(){return this.secondarySymbols},SymbolSize.prototype.getTotalSymbols=function(){return this.totalSymbols},SymbolSize.prototype.getSymbolTypeSize=function(){return this.symbolTypeSize},SymbolSize.prototype.getHeight=function(){return this.height},SymbolSize.prototype.getWidth=function(){return this.width},SymbolSize.prototype.getDataCodewords=function(){return this.dataCodewords},SymbolSize.prototype.getRSNumber=function(){return this.rsNumber};var JABCode=function(r,t,e){this.data=r,this.primarySymbol=t,this.secondarySymbols=e,this.symbolSize=new SymbolSize(t,e),this.symbol=new Symbol(this.primarySymbol,this.secondarySymbols,this.data,t),this.moduleData=new Array,this.initModuleData(),this.placeFinderPatterns(),this.placeData()};JABCode.prototype.initModuleData=function(){for(var r=0;r<this.symbolSize.getHeight();r++){this.moduleData.push(new Array);for(var t=0;t<this.symbolSize.getWidth();t++)this.moduleData[r].push(void 0)}},JABCode.prototype.placeFinderPatterns=function(){for(var r=0;r<this.symbolSize.getHeight();r++)for(var t=0;t<this.symbolSize.getWidth();t++)this.placeFinderPattern(r,t)},JABCode.prototype.placeFinderPattern=function(r,t){var e=this.symbolSize.getSymbolTypeSize().getDock(),a=this.symbolSize.getSymbolTypeSize().getSideLength(),n=this.symbolSize.getTotalSymbols();if(t>a*n-1)return this.setModule(r,t,JabColors.BLACK);var o=Math.floor(t/a);if(0==r&&0==t)this.setModule(r,t,JabColors.BLACK);else if(r<e&&t<e)this.setModule(r,t,JabColors.BLACK);else if(r<e&&t>=this.symbolSize.getWidth()-e)this.setModule(r,t,JabColors.RED);else if(r>=this.symbolSize.getHeight()-e&&t<e)this.setModule(r,t,JabColors.GREEN);else if(r>=this.symbolSize.getHeight()-e&&t>=this.symbolSize.getWidth()-e)this.setModule(r,t,JabColors.BLUE);else if(t%(a+1)==a)this.setModule(r,t,JabColors.BLACK);else if(r<e)t%2==0?this.setModule(r,t,JabColors.LIME):this.setModule(r,t,JabColors.VIOLET);else if(r>=this.symbolSize.getHeight()-e)t%2==0?this.setModule(r,t,JabColors.AZURE):this.setModule(r,t,JabColors.ORANGE);else if(t-o*(a+1)<e)r%2==0?this.setModule(r,t,JabColors.LIME):this.setModule(r,t,JabColors.VIOLET);else if(t-o*(a+1)>=a-e)r%2==0?this.setModule(r,t,JabColors.AZURE):this.setModule(r,t,JabColors.ORANGE);else{var i=this.symbolSize.getSymbolTypeSize().getTile(),l=Math.floor((r-e)/i),d=Math.floor((t-e-o*(e-1))/i);r-e-l*i==i-1&&t-e-o*(e-1)-d*i==i-1?this.setModule(r,t,JabColors.BLACK):r-e-l*i==i-1?t%2==0?this.setModule(r,t,JabColors.LIME):this.setModule(r,t,JabColors.VIOLET):t-e-o*(e-1)-d*i==i-1?r%2==0?this.setModule(r,t,JabColors.LIME):this.setModule(r,t,JabColors.VIOLET):this.setModule(r,t,new Color(7))}},JABCode.prototype.placeData=function(){for(var r=this.getBitStream(),t=0;t<r.length;t++){var e=this.getNextLocation(),a=r[t],n=this.getColor(a,e[0],e[1]);this.setModule(e[0],e[1],n,a)}},JABCode.prototype.getColor=function(r,t,e){var a=this.symbolSize.getSymbolTypeSize().getSideLength(),n=this.symbolSize.getTotalSymbols(),o=new Array(9);for(i=0;i<9;i++)o[i]=r[i];if(1==this.symbolSize.getSymbolTypeSize().getPalette())return new Color(ColorUtils.colorValue(o));var l=this.symbolSize.getSymbolTypeSize().getDock(),d=Math.floor(e/(a+1));return t<l?e%2==0?new Color(this.add(o,ColorUtils.get9Bits(ColorUtils.colorValue(JabColors.LIME.getBits())))):new Color(this.add(o,ColorUtils.get9Bits(ColorUtils.colorValue(JabColors.VIOLET.getBits())))):t>=this.symbolSize.getHeight()-l?e%2==0?new Color(this.add(o,ColorUtils.get9Bits(ColorUtils.colorValue(JabColors.AZURE.getBits())))):new Color(this.add(o,ColorUtils.get9Bits(ColorUtils.colorValue(JabColors.ORANGE.getBits())))):e-d*(a+1)<l?t%2==0?new Color(this.add(o,ColorUtils.get9Bits(ColorUtils.colorValue(JabColors.LIME.getBits())))):new Color(this.add(o,ColorUtils.get9Bits(ColorUtils.colorValue(JabColors.VIOLET.getBits())))):e-d*(a+1)>=a-l?t%2==0?new Color(this.add(o,ColorUtils.get9Bits(ColorUtils.colorValue(JabColors.AZURE.getBits())))):new Color(this.add(o,ColorUtils.get9Bits(ColorUtils.colorValue(JabColors.ORANGE.getBits())))):new Color(this.add(o,ColorUtils.get9Bits(7)))},JABCode.prototype.add=function(r,t){for(var e=new Array(9),a=0;a<9;a++)e[a]=(r[a]+t[a])%2;return ColorUtils.colorValue(e)},JABCode.prototype.getBitStream=function(){var r=new BitStream,t=this.getByteStream(),e=this.symbolSize.getDataCodewords();r.add(2,2),r.add(t.length,Math.ceil(Math.log2(e)));for(var a=0;a<t.length;a++){var n=t[a];r.add(n,8)}var o=r.getBits(),i=this.symbolSize.getDataCodewords()*this.symbolSize.getSymbolTypeSize().getBitsPerCodeword()-o.length;i>0&&r.add(0,i);var l=r.getBits(),d=new Array;for(a=0;a<this.symbolSize.getDataCodewords();a++){for(var s=0,b=0;b<this.symbolSize.getSymbolTypeSize().getBitsPerCodeword();b++)s+=Math.pow(2,this.symbolSize.getSymbolTypeSize().getBitsPerCodeword()-1-b)*l[this.symbolSize.getSymbolTypeSize().getBitsPerCodeword()*a+b];d.push(s)}var u=this.symbolSize.getRSNumber(),c=ReedSolomon.encode(d,u),g=new Array;for(a=0;a<c.length;a++)for(var h=c[a],C=this.symbolSize.getSymbolTypeSize().getBitsPerCodeword()-1;C>=0;C--){var p=h-Math.pow(2,C);p>=0?(g.push(1),h=p):g.push(0)}var f=new Array,y=0;for(a=0;a<l.length;a+=9)f[y]=l.slice(a,a+9),y++;for(a=0;a<g.length;a+=9)f[y]=g.slice(a,a+9),y++;return f},JABCode.prototype.getByteStream=function(){var r=new Array;if(0==this.symbolSize.getSymbolTypeSize().getEncodingMode())for(var t=0;t<this.data.length;t++)r.push(this.data.charCodeAt(t));else if(1==this.symbolSize.getSymbolTypeSize().getEncodingMode()){var e=this.data.split(""),a=new Array;for(t=0;t<e.length;t+=2)t+1<e.length?a.push(45*parseInt(e[t])+parseInt(e[t+1])):a.push(45*parseInt(e[t]));r=a}return r},JABCode.prototype.setModule=function(r,t,e,a){var n=new Module(r,t,e,a);this.moduleData[r][t]=n},JABCode.prototype.getModule=function(r,t){return this.moduleData[r][t]},JABCode.prototype.getNextLocation=function(){for(var r=0;r<this.symbolSize.getHeight();r++)for(var t=0;t<this.symbolSize.getWidth();t++)if(void 0==this.getModule(r,t))return[r,t]},JABCode.prototype.getModuleData=function(){return this.moduleData};var BitStream=function(){this.bits=new Array,this.byte=new Array};BitStream.prototype.add=function(r,t){for(var e=t-1;e>=0;e--){var a=r-Math.pow(2,e);a>=0?(this.bits.push(1),r=a):this.bits.push(0)}},BitStream.prototype.addByte=function(r){for(var t=7;t>=0;t--){var e=r-Math.pow(2,t);e>=0?(this.bits.push(1),this.byte.push(1),r=e):(this.bits.push(0),this.byte.push(0))}},BitStream.prototype.getBits=function(){return this.bits},BitStream.prototype.getTerminator=function(r){for(var t=r-Math.ceil(this.bits.length/9),e=new Array,a=0;a<t;a++){var n=a%2==0?[0,0,1,0,0,1,0,0,1]:[0,1,0,0,1,0,0,1,0];e=e.concat(n)}return e};var Module=function(r,t,e,a){this.x=r,this.y=t,this.color=e,this.isData=!1,void 0!=a&&(this.isData=!0,this.bitValue=a)};Module.prototype.getColor=function(){return this.color.getColor()},Module.prototype.isData=function(){return this.isData};var SymbolTypeSize=function(r){switch(r){case 0:this.sideLength=29,this.dock=3,this.tile=4,this.dataCodewords=20,this.rsNumber=10,this.palette=0,this.encodingMode=0,this.bitsPerCodeword=8,this.extraBits=0;break;case 1:this.sideLength=29,this.dock=3,this.tile=4,this.dataCodewords=20,this.rsNumber=10,this.palette=1,this.encodingMode=0,this.bitsPerCodeword=9,this.extraBits=0;break;case 2:this.sideLength=29,this.dock=3,this.tile=4,this.dataCodewords=20,this.rsNumber=10,this.palette=2,this.encodingMode=0,this.bitsPerCodeword=9,this.extraBits=0;break;case 3:this.sideLength=39,this.dock=4,this.tile=5,this.dataCodewords=42,this.rsNumber=15,this.palette=0,this.encodingMode=0,this.bitsPerCodeword=8,this.extraBits=0;break;case 4:this.sideLength=39,this.dock=4,this.tile=5,this.dataCodewords=42,this.rsNumber=15,this.palette=1,this.encodingMode=0,this.bitsPerCodeword=9,this.extraBits=0;break;case 5:this.sideLength=39,this.dock=4,this.tile=5,this.dataCodewords=42,this.rsNumber=15,this.palette=2,this.encodingMode=0,this.bitsPerCodeword=9,this.extraBits=0;break;case 6:this.sideLength=55,this.dock=5,this.tile=6,this.dataCodewords=90,this.rsNumber=20,this.palette=0,this.encodingMode=0,this.bitsPerCodeword=8,this.extraBits=0;break;case 7:this.sideLength=55,this.dock=5,this.tile=6,this.dataCodewords=90,this.rsNumber=20,this.palette=1,this.encodingMode=0,this.bitsPerCodeword=9,this.extraBits=0;break;case 8:this.sideLength=55,this.dock=5,this.tile=6,this.dataCodewords=90,this.rsNumber=20,this.palette=2,this.encodingMode=0,this.bitsPerCodeword=9,this.extraBits=0;break;case 9:this.sideLength=29,this.dock=3,this.tile=4,this.dataCodewords=41,this.rsNumber=15,this.palette=0,this.encodingMode=1,this.bitsPerCodeword=8,this.extraBits=4;break;case 10:this.sideLength=29,this.dock=3,this.tile=4,this.dataCodewords=41,this.rsNumber=15,this.palette=1,this.encodingMode=1,this.bitsPerCodeword=9,this.extraBits=0;break;case 11:this.sideLength=29,this.dock=3,this.tile=4,this.dataCodewords=41,this.rsNumber=15,this.palette=2,this.encodingMode=1,this.bitsPerCodeword=9,this.extraBits=0}};SymbolTypeSize.prototype.getSideLength=function(){return this.sideLength},SymbolTypeSize.prototype.getDock=function(){return this.dock},SymbolTypeSize.prototype.getTile=function(){return this.tile},SymbolTypeSize.prototype.getDataCodewords=function(){return this.dataCodewords},SymbolTypeSize.prototype.getRSNumber=function(){return this.rsNumber},SymbolTypeSize.prototype.getPalette=function(){return this.palette},SymbolTypeSize.prototype.getEncodingMode=function(){return this.encodingMode},SymbolTypeSize.prototype.getBitsPerCodeword=function(){return this.bitsPerCodeword},SymbolTypeSize.prototype.getExtraBits=function(){return this.extraBits};
    </script>

    <script>
        // DOM Elements
        const banknoteContainer = document.getElementById('banknote-container');
        const amountDisplay = document.getElementById('amount-display');
        const serialDisplay = document.getElementById('serial');
        const keyDisplay = document.getElementById('key');
        const visualKeyDisplay = document.getElementById('visual-key');
        const barcodes = [
            document.getElementById('barcode-1'),
            document.getElementById('barcode-2'),
            document.getElementById('barcode-3'),
            document.getElementById('barcode-4')
        ];
        const redesignBtn = document.getElementById('redesignBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const generateAllBtn = document.getElementById('generateAllBtn');
        const inputAmount = document.getElementById('inputAmount');
        const inputCount = document.getElementById('inputCount');
        const validationKeyInput = document.getElementById('validationKey');
        const validateBtn = document.getElementById('validateBtn');
        const validationResult = document.getElementById('validationResult');

        let validKeys = {};
        // The JabcodeJSInterface class is now globally available from the script above
        const jabcode = new JabcodeJSInterface();

        /**
         * Generates a time-based code using the current time and a salt.
         * @param {number} length - The desired length of the code.
         * @param {number} salt - A number to make the generated code unique.
         * @returns {string} The generated time-based code.
         */
        function generateTimeBasedCode(length, salt) {
            const time = Math.floor(Date.now() / 1000); // Time in seconds
            let code = (time * salt).toString(36).toUpperCase();
            while (code.length < length) {
                code = '0' + code;
            }
            return code.slice(-length);
        }

        /**
         * Generates a random alphanumeric code.
         * @param {number} length - The desired length of the code.
         * @returns {string} The random code.
         */
        function generateRandomCode(length) {
            return Math.random().toString(36).substring(2, 2 + length).toUpperCase();
        }

        /**
         * Generates a random hex color string.
         * @returns {string} A color in hex format (e.g., "#RRGGBB").
         */
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        /**
         * Determines if a background color is light or dark and returns a contrasting text color.
         * @param {string} hexcolor - The background color in hex format.
         * @returns {string} Either "#000000" (black) or "#FFFFFF" (white).
         */
        function getContrastYIQ(hexcolor) {
            hexcolor = hexcolor.replace("#", "");
            const r = parseInt(hexcolor.substr(0, 2), 16);
            const g = parseInt(hexcolor.substr(2, 2), 16);
            const b = parseInt(hexcolor.substr(4, 2), 16);
            const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return (yiq >= 128) ? '#000000' : '#FFFFFF';
        }

        /**
         * Updates the banknote with new colors, keys, and JAB codes.
         */
        async function updateBanknote() {
            // --- Generate New Data ---
            const amount = inputAmount.value;
            const newSerial = generateTimeBasedCode(8, 12345);
            const newVerificationKey = generateTimeBasedCode(8, 67890);
            const newVisualKey = generateRandomCode(8);

            // --- Update Visuals ---
            const newBgColor = getRandomColor();
            const newTextColor = getContrastYIQ(newBgColor);

            banknoteContainer.style.backgroundColor = newBgColor;
            [amountDisplay, serialDisplay, keyDisplay, visualKeyDisplay].forEach(el => {
                el.style.color = newTextColor;
            });

            serialDisplay.innerText = newSerial;
            keyDisplay.innerText = newVerificationKey;
            visualKeyDisplay.innerText = newVisualKey;
            amountDisplay.innerText = amount;

            // --- Generate and Assign JAB Codes ---
            const dataForBarcodes = [amount, newSerial, newVerificationKey, newVisualKey];
            dataForBarcodes.forEach((data, i) => {
                if (data) {
                    barcodes[i].src = jabcode.encode_message(data, 1, 10);
                }
            });

            // Store the key for validation
            validKeys[newVerificationKey] = true;
        }

        /**
         * Draws the current banknote design onto a hidden canvas and triggers a download.
         */
        async function createAndDownloadBanknote() {
            const canvas = document.getElementById('banknoteCanvas');
            const ctx = canvas.getContext('2d');

            // Get computed styles from the displayed banknote
            const bgColor = window.getComputedStyle(banknoteContainer).backgroundColor;
            const textColor = window.getComputedStyle(amountDisplay).color; // All text has same color

            // 1. Draw banknote background
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Draw Text (Amount, Serial, Keys)
            ctx.fillStyle = textColor;
            ctx.font = "bold 40px Vazir";
            ctx.textAlign = "right";
            ctx.fillText(amountDisplay.innerText, 580, 60);

            ctx.font = "bold 24px Vazir";
            ctx.textAlign = "left";
            ctx.fillText(serialDisplay.innerText, 20, 40);
            ctx.fillText(keyDisplay.innerText, 20, 75);
            ctx.fillText(visualKeyDisplay.innerText, 20, 110);

            // 3. Draw all four JAB Codes onto the canvas
            const barcodeDrawPromises = barcodes.map((barcodeImg, index) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        // Position the barcodes in a 2x2 grid in the center
                        const x = (index % 2 === 0) ? 125 : 325;
                        const y = (index < 2) ? 150 : 250;
                        ctx.globalAlpha = 0.8; // Make JAB codes more visible on canvas
                        ctx.drawImage(img, x, y, 150, 150);
                        ctx.globalAlpha = 1.0; // Reset alpha
                        resolve();
                    };
                    img.onerror = () => resolve(); // Resolve even if image fails to load
                    img.src = barcodeImg.src;
                });
            });

            await Promise.all(barcodeDrawPromises);

            // 4. Trigger Download
            const link = document.createElement('a');
            link.download = `banknote-${serialDisplay.innerText}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        /**
         * Generates and downloads a specified number of unique banknotes.
         */
        async function generateAllBanknotes() {
            const count = parseInt(inputCount.value);
            if (count > 0) {
                for (let i = 0; i < count; i++) {
                    await updateBanknote();
                    // A small delay to ensure the next banknote gets a new time-based key
                    await new Promise(resolve => setTimeout(resolve, 50));
                    await createAndDownloadBanknote();
                }
            }
        }

        /**
         * Validates the user-entered key against the list of generated keys.
         */
        function validateKey() {
            const inputKey = validationKeyInput.value.toUpperCase();
            validationResult.style.display = 'block';
            if (validKeys[inputKey]) {
                validationResult.className = 'validation-result valid';
                validationResult.innerText = '✅ This banknote is valid.';
            } else {
                validationResult.className = 'validation-result invalid';
                validationResult.innerText = '❌ This banknote is invalid.';
            }
        }

        // --- Event Listeners ---
        redesignBtn.addEventListener('click', updateBanknote);
        downloadBtn.addEventListener('click', createAndDownloadBanknote);
        generateAllBtn.addEventListener('click', generateAllBanknotes);
        validateBtn.addEventListener('click', validateKey);

        inputAmount.addEventListener('input', (e) => {
            let value = parseInt(e.target.value);
            if (isNaN(value)) value = 1;
            if (value > 100) value = 100;
            if (value < 1) value = 1;

            e.target.value = value;
            amountDisplay.innerText = value;
            // Update the amount JAB code in real-time
            barcodes[0].src = jabcode.encode_message(String(value), 1, 10);
        });

        // --- Initial Setup ---
        updateBanknote();
    </script>
</body>
</html>
